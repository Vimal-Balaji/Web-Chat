<!DOCTYPE html>
<html>
<head>
    <title>Private Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h2>Private Messaging</h2>
    <div id="chat" style="border:1px solid black;height:200px;width:400px;overflow:auto;padding:5px;"></div>

    <label for="userSelect">Send to:</label>
    <select id="userSelect"></select>
    <br><br>

    <input type="text" id="msgBox" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>

    <script>
        const socket = io();

        socket.on("connect", () => {
            console.log("Connected to server");
        });

        // Update user dropdown when list changes
        socket.on("user_list", (users) => {
            let select = document.getElementById("userSelect");
            select.innerHTML = "";
            users.forEach(user => {
                let option = document.createElement("option");
                option.value = user;
                option.text = user;
                select.appendChild(option);
            });
        });

        // Show incoming private messages
        socket.on("private_message", (data) => {
            let chat = document.getElementById("chat");
            chat.innerHTML += `<div><b>From:</b> ${data.from} â†’ <b>To:</b> ${data.to} | ${data.msg}</div>`;
            chat.scrollTop = chat.scrollHeight;
        });

        function sendMessage() {
            let msgBox = document.getElementById("msgBox");
            let receiver = document.getElementById("userSelect").value;
            let message = msgBox.value;

            if(message.trim() !== ""){
                socket.emit("private_message", {to: receiver, msg: message});
                msgBox.value = "";
            }
        }
    </script>
</body>
</html>
